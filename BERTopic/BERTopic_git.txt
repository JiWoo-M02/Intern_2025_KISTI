import pandas as pd
from bertopic import BERTopic

# 1. CSV 파일 불러오기
file_path = "C:/Users/MaengJiwoo/.vscode/KISTI-intern/2025_KISTI-intern/overlapped_entities.csv"
df = pd.read_csv(file_path, encoding="windows-1252")

# 2. entity_text 컬럼에서 텍스트 리스트 추출
docs = df["entity_text"].dropna().astype(str).tolist()

# 3. BERTopic 모델 초기화 및 학습
topic_model = BERTopic(language="multilingual")  # 한국어 포함 multilingual 모델
topics, probs = topic_model.fit_transform(docs)

# 4. 토픽 정보 출력
topic_info = topic_model.get_topic_info()
print(topic_info.head())  # 상위 5개 토픽 확인

# 5. 특정 토픽 키워드 출력 예시
print("\n[Topic 0 키워드]")
print(topic_model.get_topic(0))

# 6. 문서별 토픽 분류 결과 저장
df["topic"] = topics
df.to_csv("entity_topic_classification.csv", index=False, encoding="utf-8-sig")

# 7. 토픽별 정보 저장
topic_info.to_csv("topic_info.csv", index=False, encoding="utf-8-sig")